# Problem pe-637 Findings

## Problem Summary
Compute
- `g(10^7, 10, 3) mod 99991`
- where `g(n,B1,B2) = sum_{1<=i<=n, f(i,B1)=f(i,B2)} i`
- and `f(n,B)` is the minimum number of split-and-sum steps to reach a single base-`B` digit.

## Correct Answer
`99107`

## Correct Approach
- `f(i,B)=0` iff `i < B`.
- `f(i,B)=1` iff `digit_sum_B(i) < B`.
  - Reason: splitting into individual digits gives the minimum possible one-step sum.
- For `digit_sum_B(i) >= B`, `f(i,B)=2` iff there exists at least one partition with sum `s` such that `digit_sum_B(s) < B`.
- Otherwise `f(i,B)=3` (for this range).
- Practical bounds for `i <= 10^7`:
  - base 10 has at most 8 digits
  - base 3 has at most 15 digits
  - this keeps partition search feasible with aggressive early exit.
- Efficient implementation:
  - precompute `digit_sum_10` and `digit_sum_3` arrays up to `10^7`
  - for each `i`, run a DFS/stack partition search only when needed (`digit_sum_B(i) >= B`)
  - early exit on first partition sum with `digit_sum_B(s) < B`
  - add `i` when `f(i,10)==f(i,3)`, keep modulo `99991`.

## Known Wrong Approaches

### Wrong approach A (answer `23665`)
- Assumes `f(i,B)` is always in `{0,1,2}` for this range.
- Uses simplified rule:
  - `f=0` if `i<B`
  - `f=1` if `digit_sum_B(i) < B`
  - else `f=2`
- Then reduces equality to XOR-style threshold checks on digit sums.
- This passes the checkpoint `g(100,10,3)=3302` but fails at `10^7` because it misses genuine `f=3` cases.

### Wrong approach B (answer `76117`)
- Spends most effort on optimization variants for partition-search but does not complete a verified exact run for `N=10^7`.
- Ends with a placeholder/non-exact final value rather than a computed exact result.

## Critical Failure Pattern
- The main conceptual trap is collapsing the `digit_sum_B(i) >= B` branch directly to `f=2`.
- Correct logic requires an explicit existential partition check for a sum `s` with `digit_sum_B(s) < B`; without that check, results are wrong.
