# Project Euler 448 - Average Least Common Multiple

## Problem
Let
- `A(n) = (1/n) * sum_{i=1}^n lcm(n,i)`
- `S(n) = sum_{k=1}^n A(k)`

Need `S(99999999019) mod 999999017`.

## Correct Answer
- `530553372`

## Correct approach
1. Rewrite the average:
- `lcm(n,i) = n*i/gcd(n,i)`
- `A(n) = sum_{i=1}^n i/gcd(n,i)`

2. Convert to divisor sum:
- `A(n) = (1 + sum_{d|n} d*phi(d)) / 2`
- Therefore:
- `S(N) = (N + T(N)) / 2`
- `T(N) = sum_{d=1}^N d*phi(d)*floor(N/d)`

3. Compute `T(N)` efficiently:
- Let `U(x) = sum_{n<=x} n*phi(n)`.
- Group equal values of `floor(N/d)`:
- `T(N) = sum_q q * ( U(r_q) - U(l_q-1) )`, where `d in [l_q, r_q]` is the interval with `floor(N/d)=q`.
- Equivalent form: `T(N) = sum_{k=1}^N U(floor(N/k))` with floor-division grouping.

4. Use a fast summatory algorithm for multiplicative `n*phi(n)`:
- `n*phi(n)` is multiplicative with prime-power values `p^a * phi(p^a) = p^{2a-1}(p-1)`.
- Use a correct high-performance summatory method (e.g., Min_25 / Dujiao-style implementation) and modular arithmetic under `999999017`.

## Wrong approaches observed
1. Wrong final value `106467648`:
- A repeated failure mode computes an internally consistent but incorrect chain using auxiliary weighted-Möbius recurrences and transformations between `A/F3/H`-type helper sums.
- The derivation mixes non-equivalent weighted sums (notably `d`-weighted vs `d^2`-weighted kernels), which can still pass small checks like `S(100)=122726` but gives the wrong final modulus.

2. Incorrect convolution substitution:
- Treating `u(n)=n*phi(n)` as `mu * id^2` is wrong for this target and leads to incorrect summation formulas.
- This produces contradictory identities in later checks.

3. Non-rigorous fallback heuristics:
- Pattern guessing (e.g., “maybe the result is simple/zero/periodic mod p”) does not resolve the problem and should not replace a valid summatory derivation.

## Known wrong / incomplete outcomes
- Wrong numeric outcome observed: `106467648`.
- One long trace ends without committing a final numeric answer.
