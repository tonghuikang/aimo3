# Problem pe-403 Findings

## Problem Summary
For integers a and b, D(a,b) is the domain enclosed by parabola y = x^2 and line y = ax + b.
L(a,b) counts lattice points (integer x,y) in D(a,b).
S(N) sums L(a,b) over all pairs with rational area and |a|,|b| <= N.
Find S(10^12) mod 10^8.

## Correct Answer
**18224771**

## Key Insights

### 1. Area Formula
Area of D(a,b) = (Δ^{3/2})/6 where Δ = a² + 4b.
Area is rational iff Δ is a perfect square (Δ = k² for integer k >= 0).

### 2. L(a,b) Only Depends on k
A crucial simplification: L(a,b) = L(k) = (k+1)(k² - k + 6)/6
This is independent of a! The number of lattice points depends only on k = sqrt(a² + 4b).

### 3. Parameterization via (m,n)
The pairs (a,b) with rational area correspond bijectively to integer pairs (m,n) via:
- a = m - n
- b = m*n
- k = |m + n|

Constraints: |a| = |m-n| <= N and |b| = |mn| <= N.

### 4. Sum Reformulation
S(N) = Σ_{(m,n): m+n >= 0, |m-n| <= N, |mn| <= N} L(m+n)
     = Σ_{s=0}^{N+1} L(s) * f_s

where f_s counts integer pairs (m,n) with sum s satisfying the constraints.

## Common Errors

### Wrong approach in a033f9.txt (no final committed answer; conflicting candidates like 71594279 and 75618003)
The trace attempts several approximation-based pipelines but fails to stabilize a correct global method:
- Inconsistent handling of middle/transition ranges where floor/sqrt corrections matter
- Repeated heuristic threshold tuning (`factor_small`, dynamic streak detection) without a proof that approximations are valid for all required m
- Contradictory large-N outputs from different approximations
- Ends without a finalized, validated result

### Correct approach in ynbn4d.txt and 6y2r1z.txt (both give 18224771)
- Properly derive `L(k)` and reduce to counting multiplicities by transformed variables
- Keep the exact integer constraints (`k >= 0`, `|a| <= N`, `|b| <= N`) in the counting formulas
- Use O(sqrt(N)) block/group summation with polynomial prefix sums
- Validate against provided checks (`S(5)`, `S(100)`) and additional brute-force small-N tests

## Formula for f_s
For each s >= 0, count integer pairs (m,n) with m+n = s, |m-n| <= N, |mn| <= N.
Equivalently, count integer w with |w| <= N, w ≡ s (mod 2), |s² - w²| <= 4N.
This gives f_s = 2 * E_s - δ_s where:
- E_s = count of w in [L_s, W_s] with correct parity
- L_s = ceil(sqrt(max(0, s² - 4N)))
- W_s = floor(min(N, sqrt(s² + 4N)))
- δ_s = 1 if s even and L_s = 0, else 0
