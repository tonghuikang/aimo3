Problem: pe-652 - D(10^18) last 9 digits

Correct answer: 983924497

Correct approach (problem-level)
- Model values by equivalence classes of `log_m(n)` under the proto-log relation.
- Write each integer as `x = c^e` where `c` is not a perfect power (its core) and `e >= 1`.
- Let `L = floor(log2 N)`.
- Rational classes are exactly reduced fractions `p/q` with `1 <= p,q <= L`:
  - `R_rat = 2 * sum_{i=1..L} phi(i) - 1`.
- For irrational classes, group cores by exponent capacity:
  - `E(c) = floor(log_c N)`.
  - `C_k = #{ core c : E(c)=k }`.
  - For each ordered pair of distinct cores `(c1,c2)`, the number of distinct ratios is
    `R(k,l) = #{ (e,f): 1<=e<=k, 1<=f<=l, gcd(e,f)=1 }`
    `= sum_{d=1..min(k,l)} mu(d) * floor(k/d) * floor(l/d)`.
  - Total irrational contribution:
    `I = sum_{k,l} C_k*C_l*R(k,l) - sum_k C_k*R(k,k)`.
- Final count:
  - `D(N) = R_rat + I`.
- This reproduces the checkpoints `D(5)=13`, `D(10)=69`, `D(100)=9607`, `D(10000)=99959605`, and gives last 9 digits `983924497` for `N=10^18`.

Wrong approaches and failure modes
- Under-counting model: treating each ordered distinct core pair as contributing only one irrational value (ignoring exponent-ratio multiplicity) gives wrong totals.
- Over-simplified formula `D = total_pairs - same_core_pairs + R_rat` is incorrect for the same reason.
- Numerical failure: using floating nth roots like `int(x ** (1.0/e))` for boundary-sensitive counting at `N=10^18` causes off-by-one root errors and yields the wrong final residue `981926491`.
- Robust implementation requires exact integer root computation (binary search or exact corrected root logic).
