# Problem PE_366

## Correct answer
- `88351299` (already modulo `10^8`)

## Correct approach
- Let Fibonacci numbers be `F1=1, F2=2, Fi=F_{i-1}+F_{i-2}`.
- Known initial losing pile sizes are exactly Fibonacci numbers, matching the check `sum_{n<=100} M(n)=728`.
- For any `n`, let `F` be the largest Fibonacci number `<= n`, and `m=n-F`.
- Correct recurrence for first-move optimum:
  - `M(n)=0` if `m=0` (i.e., `n` is Fibonacci).
  - `M(n)=m` if `2m < F`.
  - `M(n)=M(m)` if `2m >= F`.
- Then compute prefix sums `S(N)=sum_{n=1}^N M(n)` recursively:
  - Let `F = largest fib <= N`, `U=N-F`, `T=(F-1)//2`.
  - If `U <= T`:  
    `S(N)=S(F-1) + U(U+1)/2`.
  - Else:  
    `S(N)=S(F-1) + T(T+1)/2 + (S(U)-S(T))`.
- Memoizing `S` over queried arguments gives fast evaluation for `N=10^18`.

## Wrong approaches and why they fail
- **Wrong rule: `M(n)=n-F_prev` for all non-Fibonacci `n`**  
  Fails near the upper part of Fibonacci intervals, because leaving a Fibonacci remainder is not enough when opponentâ€™s bound `2k` is too large.
- **Wrong rule: `M(n)` equals the smallest Zeckendorf summand of `n`**  
  That gives a valid winning move but not always the maximum one (e.g., positions like `n=17` have larger winning first moves).
- **Wrong state model: only `(r,b)` with Fibonacci `r` are losing**  
  In the two-parameter game state `(remaining r, bound b)`, some non-Fibonacci `r` with small `b` are also losing; ignoring this breaks derivations for maximal first move.
