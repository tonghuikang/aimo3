# PE 888 Annotation Findings

## Problem
Count losing positions for a take-and-break impartial game:
- Heap moves: remove `1,2,4,9` stones, or split a heap into two non-empty heaps.
- A position with `m` heaps (sizes in `[1,N]`, order ignored) is losing iff heap Grundy XOR is `0`.

## Correct answer
- `S(12491249,1249) mod 912491249 = 227429102`

## Correct approach
1. Compute heap Grundy numbers with
   - subtraction moves to `g(n-1), g(n-2), g(n-4), g(n-9)`
   - split moves `g(a) xor g(n-a)`.
2. Convert multiset counting to parity-subset counting:
   - write multiplicities as `x_i = p_i + 2e_i` (`p_i in {0,1}`),
   - XOR condition depends only on the odd-parity subset.
3. Use
   - `S(N,m) = sum_{s â‰¡ m (mod 2)} A_s * C((m-s)/2 + N - 1, N - 1)`,
   - where `A_s` is the number of subsets of pile sizes (from `1..N`) of size `s` with Grundy XOR `0`.
4. For large `N`, exploit eventual periodicity of the Grundy sequence:
   - periodic start at index `322` (preperiod length `321`),
   - period length `11060`.
   - This gives exact frequency counts `f_g` in `[1,N]` via preperiod + full cycles + remainder.
5. Compute `A_s` by DP over Grundy values using `C(f_g,k)` and XOR/parity transitions, then evaluate the sum modulo `912491249`.

## Wrong approach(es)

### Wrong answer: `584658004`
- Uses the same high-level formula but builds large-`N` Grundy frequencies incorrectly.
- In the large-`N` frequency construction, preperiod counts are accidentally dropped when rebuilding the frequency map, so `f_g` is wrong even though sample checks still pass.
- Also relies on a fixed period-start heuristic (`start_guess=300`) instead of enforcing the validated periodic start consistently in the final counting path.

## Trace outcome summary
- `ax8zyu`: correct (`227429102`)
- `bmoe6h`: correct (`227429102`)
- `bmqjbh`: wrong (`584658004`)
