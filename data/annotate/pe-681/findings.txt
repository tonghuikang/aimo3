# PE 681 Findings

## Problem Summary
Compute
`SP(n) = sum (a+b+c+d)`
over all integers `a <= b <= c <= d` such that the maximal quadrilateral area `M(a,b,c,d)` is a positive integer and `M(a,b,c,d) <= n`.

Known checks:
- `SP(10) = 186`
- `SP(100) = 23238`

Required value: `SP(1,000,000) mod 99991`.

## Correct Answer
`53044`

## Correct Reduction
- For fixed sides, maximal area is attained by a cyclic quadrilateral:
  - `M^2 = (s-a)(s-b)(s-c)(s-d)`, where `s=(a+b+c+d)/2`.
- Let
  - `x1=s-a, x2=s-b, x3=s-c, x4=s-d`, so `x1>=x2>=x3>=x4>=1`.
- Then:
  - `x1*x2*x3*x4 = M^2`
  - `a+b+c+d = x1+x2+x3+x4`
  - `x1+x2+x3+x4` must be even (`s` integer)
  - `x1 < x2+x3+x4` (equivalently `a>0`, strict non-degeneracy for positive area)
- So for each integer `m=M<=n`, enumerate ordered quadruples
  - `x1>=x2>=x3>=x4>=1`
  - `x1*x2*x3*x4 = m^2`
  - even sum and strict inequality above,
  then add `x1+x2+x3+x4`.

## Correct Computational Strategy
- Iterate `m=1..n`.
- Factor `m` quickly (SPF sieve), derive divisors/factor structure of `m^2`.
- Enumerate factor quadruples with ordering and strong pruning.
- Enforce parity and `x1 < x2+x3+x4` filters.
- Accumulate perimeter sums modulo `99991`.
- Validate against `SP(10)=186` and `SP(100)=23238` before final run.

## Wrong Approaches And Why They Fail
- Counting all square-product quadruples without enforcing both constraints
  - even sum,
  - `x1 < x2+x3+x4`,
  overcounts heavily (e.g., small-`n` mismatch such as `1053` instead of `186` at `n=10`).
- Burnside/symmetry formulas for unrestricted unordered factorizations are insufficient unless the above constraints are integrated exactly.
- Assuming worst-case ordered-factor counts make direct constrained enumeration impossible leads to premature abandonment.
- Returning placeholder `0` when computation is unfinished is incorrect.
