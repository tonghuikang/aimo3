# PE 580: Squarefree Hilbert Numbers - Annotation Findings

## Problem
Count Hilbert numbers `n <= 10^16` (`n ≡ 1 (mod 4)`) that are **not divisible** by `h^2` for any Hilbert number `h > 1`.
Return the count modulo `99991`.

## Correct Answer
- `30815`

## Correct Approach
Use ordinary prime exponents and characterize valid `n` exactly:
- For primes `p ≡ 1 (mod 4)`: exponent `e_p ∈ {0,1}`.
- For primes `q ≡ 3 (mod 4)`: exponent `e_q ∈ {0,1,2,3}`.
- At most one `q ≡ 3 (mod 4)` can have exponent `>= 2`.
- Parity condition for `n ≡ 1 (mod 4)`: the total number of odd exponents among `q ≡ 3 (mod 4)` is even.

A practical counting decomposition used by correct traces:
- Let `S_even(M)` be the number of odd squarefree `m <= M` with even parity of `q ≡ 3 (mod 4)` factors.
- Then
  - `Count(N) = S_even(N) + sum_{q ≡ 3 prime, q^2 <= N} S_even(floor(N / q^2))`.
- This reproduces the given checkpoint `Count(10^7) = 2,327,192` and yields `Count(10^16) mod 99991 = 30815`.

Equivalent implementation details in correct traces:
- Compute `S_even` via Möbius/odd-squarefree sums (and parity split), then memoize repeated `floor(N/q^2)` arguments.

## Wrong Approaches And Why They Fail
- **Treating the task as ordinary odd squarefree counting**:
  - Misses allowed `q^2` / `q^3` (`q ≡ 3`) structure and under/overcounts.
- **Asymptotic-density-only method (`floor(cN)` style)**:
  - Gives good scale but not exact finite-`N` value modulo `99991`.
- **Incorrect cancellation formulas using `-S_even(N/q^4)` with truncated `q` range**:
  - Dropping valid `q^2` contributions for `q^4 > N` leads to systematic undercount.
- **Hilbert-monoid Möbius via unique-factorization linear sieve**:
  - Fails because Hilbert factorization is not unique in the needed way; coefficients become inconsistent (trace ended at wrong final answer `0`).

## Trace Outcomes
- `e2qyca`: correct (`30815`) after fixing baseline Möbius kernel and validating against `10^7`.
- `x9uang`: correct (`30815`) after repairing odd-squarefree/parity formulas and `q`-range handling.
- `fjzw87`: wrong (`0`) due to invalid Hilbert-prime/Möbius sieve assumptions and unresolved coefficient model.
