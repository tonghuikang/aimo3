# Problem pe-659 - Findings

## Correct answer
238518915714422000

## Correct approach
- For fixed `k`, if prime `p` divides both `n^2+k^2` and `(n+1)^2+k^2`, then `p` divides their difference `2n+1`.
- So `2n+1 ≡ 0 (mod p)` gives `n ≡ (p-1)/2 (mod p)`. Substituting into `n^2+k^2 ≡ 0 (mod p)` gives `4k^2 ≡ -1 (mod p)`.
- Therefore the primes that can divide two successive terms are exactly the prime divisors of `4k^2+1`, so
  `P(k) = LPF(4k^2+1)`.
- Compute `sum_{k=1}^{10^7} LPF(4k^2+1)` with a sieve over primes `p <= 2N` (`N=10^7`):
  - only `p ≡ 1 (mod 4)` are relevant,
  - solve residues `k (mod p)` from `(2k)^2 ≡ -1 (mod p)` (e.g., Tonelli-Shanks),
  - for each matching `k`, divide `rem[k]` by `p` repeatedly and record largest small factor,
  - final factor is `max(largest_small[k], rem[k])`; `rem[k]` captures any large prime cofactor.
- Summing these largest factors and taking modulo `10^18` gives `238518915714422000`.

## Wrong approaches and why they fail
- Misreading the prompt example: treating `n^2+3` as integer `k=3` in `n^2+k^2` causes a false contradiction (`37` vs `13`).  
  The example corresponds to `k^2=3` (non-integer `k`), while the required sum uses integer `k=1..10^7`.
- Using an invalid shortcut for `sqrt(-1) mod p` (e.g., `pow(-1, (p-1)//4, p)`) gives wrong residues, so sieve hits wrong `k` classes and the total becomes incorrect.
- Tracking only the largest small prime `<=2N` without maintaining/dividing a remainder misses cases where `4k^2+1` has a larger cofactor `>2N`, causing underestimation of `P(k)`.
