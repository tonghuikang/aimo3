Correct answer (mod 99991): 83039

Correct approach:
- For any chosen sides `(a,b,c,d)`, the maximum possible quadrilateral area is achieved by a cyclic quadrilateral.
- Use Brahmagupta-equivalent ranking metric (no floating point):
  - Let `T = a+b+c+d`.
  - Area ordering is equivalent to maximizing
    `P = (T-2a)(T-2b)(T-2c)(T-2d)`
    with feasibility `T-2*max(a,b,c,d) > 0`.
  - Tie-break by larger perimeter `T`.
- Sequence generation uses `B(2n)=B(n)`, so
  `u_n = 2^{B(3n)} + 3^{B(n)} + B(n+1)`.
- Stream prefixes `n=1..3,000,000`, maintain a bounded top-value candidate pool (with multiplicity, capped per value for 4-side selection), and evaluate candidate 4-tuples with the exact metric above.
- Recompute the best quadruple only when the candidate pool changes; accumulate `f(U_n)` for `n>=4` modulo `99991`.
- Sanity checks must match provided references:
  - `f(U_5)=59`, `f(U_10)=118`, `f(U_150)=3223`
  - `sum_{n=4}^{150} f(U_n) = 234761` (mod `99991` = `34779`).
- Final computed modulo for `n=4..3,000,000` is `83039`.

Wrong approaches and why they fail:
- Using only the four largest values (or “largest feasible four”) is not reliable.
  - Outliers can reduce area; a slightly smaller but more balanced quadruple can win.
- Using only the first feasible 4-window in sorted order is incorrect.
  - It can over-prioritize perimeter and miss a later window with larger area metric.
- Using the wrong proxy `\prod (T-a_i)` (product of sums of three sides) is incorrect.
  - The correct proxy is `\prod (T-2a_i)`.
  - This wrong metric produces benchmark mismatches (e.g., wrong `f(U_150)` / wrong `sum_{4..150}`).
