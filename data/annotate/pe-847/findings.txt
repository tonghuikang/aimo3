# PE 847: Magic Bean Problem - Findings

## Correct Answer
381868244

## Problem-Level Structure
- Let `T = a+b+c`.
- The optimal query count has the form:
  `h(a,b,c) = ceil(log2 T) + delta(a,b,c)`, where `delta in {0,1}`.
- `delta=1` means the triple is "hard" (needs one extra question beyond information-theoretic lower bound).

## Correct Approach (What Works)
- View each query on plate `i` with subset size `k` as:
  YES branch: candidates become only that subset on one plate (`(k,0,0)` up to permutation),
  NO branch: candidates become complement-on-that-plate plus other plates unchanged.
- The YES branch is always a one-plate search, so it never contributes extra hardness.
- Hardness is determined by whether every feasible split leaves a NO branch that is still hard at the required depth.
- Aggregate by total `T`:
  define `B(T)` = number of hard ordered triples with sum `T`.
- Then:
  `H(N) = sum_{T=1..N} C(T+2,2)*ceil(log2 T) + sum_{T=1..N} B(T)`.
- `B(T)` is zero outside critical total ranges and follows a recursive counting relation inside them, enabling `O(log N)` block/prefix computation (validated against `H(6)`, `H(20)`, `H(111)`).

## Critical Interval Insight
- Hard totals occur only near powers of two.
- For `L = ceil(log2 T)`, hard totals lie in:
  `T in [3*2^(L-2)+2, 2^L]`.
- Within each level, interval sums of `B(T)` recurse from the previous level, which is the key to handling `R_19` efficiently.

## Wrong Approaches (Why They Fail)
- Root-only balancing criterion:
  assuming that one balanced split at the root is sufficient is wrong; hard NO-branch subproblems can propagate recursively.
- Two-case finite characterization (case A/case B only):
  undercounts hard triples because it misses deeper recursive hard descendants.
- Split-only surrogate models:
  treating the process as pure per-plate halving without full branch semantics gives incorrect counts.
- Non-closure under ad hoc polynomial fitting:
  fitting local formulas for hard-count sequences without recurrence validation causes contradictions at larger totals.
