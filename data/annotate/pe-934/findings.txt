Problem: Compute U(10^17) where U(N) = sum_{n=1}^{N} u(n), and u(n) is the smallest prime p such that n mod p is not a multiple of 7.

Correct answer: 292137809490441370

Key definitions:
- Bad residues for prime p are multiples of 7 in {0,1,...,p-1}: {0,7,14,...}
- B(p) = floor((p-1)/7) + 1 = number of bad residues modulo p
- u(n) = smallest prime p such that n mod p is not in the bad set

Core characterization:
- u(n) = p iff:
  - for every prime q < p, n mod q is a bad residue
  - for p, n mod p is a good residue (not bad)

Correct approach:
1. For each prime p, work modulo M(p) = product of all primes <= p.
2. By CRT independence, the number of residue classes with u(n)=p in one full period is
   C(p) = (product_{q<p} B(q)) * (p - B(p)).
3. Exact count up to N:
   count_p(N) = floor(N / M(p)) * C(p) + tail_count,
   where tail_count is the number of u(n)=p residues <= N mod M(p).
4. For N=10^17, M(43) <= N < M(47):
   - p <= 43 has full cycles + tail
   - p >= 47 has no full cycle, so count comes from direct residue/tail handling
5. Numbers with u(n) > 43 correspond to 907200 residue classes modulo M(43)=13082761331670030, giving about 6.35 million such n up to 10^17. For these, scan primes >43 until the first good residue.

Useful structural observations:
- All odd n have u(n)=2 (since n mod 2 = 1).
- For even n not divisible by 3: u(n)=3.
- For n divisible by 6 but not 5: u(n)=5.
- For p < 7, B(p)=1 so "bad" means remainder 0 only (divisibility).
- For p >= 11, bad residues include nonzero values (e.g., p=11 has {0,7}).

Wrong approaches and why they fail:
- Asymptotic-only method: U(N) ≈ N * sum_p p*d(p) with d(p)=prod_{q<p}(B(q)/q)*((p-B(p))/p).
  - This gives a close average (~2.92 per n) but not an exact integer sum, so it does not solve the problem.
- Tail shortcut tail_count ≈ floor((N mod M(p)) * C(p) / M(p)).
  - Partial blocks are not uniformly distributed this way for exact counting; this can miss exact residue placement and fail exact checks.
- Truncating at p<=43 or using a fixed small prime cap for the unresolved set.
  - p>43 still contributes nontrivially; truncation undercounts U(10^17).

Verification:
- U(1470)=4293 (given check) is matched.
- Final exact value: U(10^17)=292137809490441370.
