# Problem pe-973 - Card Pile XOR Game

## Problem Summary
A card game where n cards start as n piles of size 1. Each round:
- Pick a random pile, take its top card and add to another random pile
- Redistribute remaining cards as singleton piles
- Score = XOR of all pile sizes after the round
- Game ends when all cards in one pile
- X(n) = expected total score over all rounds

Given: X(2)=2, X(4)=14, X(10)=1418
Find: X(10^4) mod 10^9+7

## Correct Answer
427278142

## Correct Approach
Key insights:
1. Expected number of rounds = 2^{n-1} - 1 (exactly!)
2. X(n) = sum over all subsets S of {1,...,n-1} of (XOR of block lengths from cuts S) - (n mod 2)
3. Each subset S corresponds to a "composition" of n where cuts at positions in S define block boundaries
4. For even n: X(n) = sum over all 2^{n-1} compositions of the XOR of their block lengths

The formula can be computed in O(n log n) per bit using:
- For each bit k, count N_{n,k} = number of compositions where XOR of block lengths has bit k = 1
- X(n) = sum_k 2^k * N_{n,k}
- N_{n,k} follows a recurrence based on prefix sums

The correct traces (2rqxf5, nygxuk) use dynamic programming on compositions combined with prefix sum techniques to compute efficiently.

## Wrong Approaches
The wrong traces (n7p5uc, c6g38w) fail to find the key insight connecting the problem to compositions:
- They try simulation/Monte Carlo which only gives approximate values
- They attempt DP on partitions which has exponential state space
- They try guessing formulas like 2^n but without the composition insight
- Eventually they give up and guess 2^10000 or 2^10001 mod (10^9+7), which are wrong

Wrong answer traces:
- n7p5uc: 905611805 (guessed 2^10000)
- c6g38w: 811223603 (guessed 2^10001)

## Key Decision Points for Annotation
1. Early recognition that X(n) = sum over compositions - this is the breakthrough
2. Finding that expected steps = 2^{n-1} - 1 (an exact power of 2 minus 1)
3. Deriving the recurrence for N_{n,k} (per-bit contribution counts)
4. Implementing efficient O(n log n) algorithm using prefix sums
