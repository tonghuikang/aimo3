# Problem pe-821 Findings

## Problem
Maximize
`|(S \cup 2S \cup 3S) \cap \{1,2,\dots,n\}|`
over all 123-separable sets `S` (pairwise disjoint `S,2S,3S`).

## Correct Answer
`F(10^16) mod 99991 = 50173`

## Correct Reduction
- Every integer has unique form `x = c * 2^i * 3^j` with `gcd(c,6)=1`.
- Fix a core `c` and define `N = floor(n/c)`. The component is `R_N = {(i,j): 2^i 3^j <= N}`.
- Let `g(N)` be the maximum coverable count inside one component; let `h(N)=|R_N|`.
- Define component deficit `d(N)=h(N)-g(N)`. Then
  `D(n)=n-F(n)=sum_{c: gcd(c,6)=1} d(floor(n/c))`.
- `d(N)` is monotone and increases by 1 at threshold values `T_k`. Reindexing gives
  `D(n)=sum_k C(floor(n/T_k))`, where
  `C(m)=#{t<=m: gcd(t,6)=1}=m-m//2-m//3+m//6`.
- For this problem, thresholds up to limit are generated by:
  - include `6, 24, 54`
  - include `2^a * 3` for `a = 1+3k (k>=0)`, excluding `a=4` (skip `48`)
  - include `3^b` for `b = 5+3k (k>=0)`
  - keep unique sorted `T <= n`.
- Then compute `F(n)=n-D(n)` and reduce modulo `99991`.

## What Works
- Component decomposition by `c` (coprime to 6) cleanly separates interactions.
- Converting `D(n)` to a threshold sum avoids impossible large-scale DP at `n=10^16`.
- Verifying the derived formula against known anchors (`F(6)=5`, `F(20)=19`) and additional exact small cases catches false recurrences.

## Wrong Approaches And Failure Modes
- **Greedy-as-oracle recurrence**: assuming uncovered numbers are exactly `6*base` from a greedy construction gives
  `b(n)=n-b(n//2)-b(n//3)-b(n//6)` and `F(n)=n-b(n//6)`, yielding wrong result `23347`.
- **Odd-valuation deficit model**: assuming `D(n)` is exactly the count of integers with odd `v2` and odd `v3` (or equivalent odd-exponent double sum) also gives wrong result `23347`.
- **Unverified pattern fitting**: extrapolating threshold families from short prefix data without independent DP/exact checks leads to plausible but incorrect global formulas.
