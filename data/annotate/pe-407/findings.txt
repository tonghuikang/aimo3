# pe-407 findings

## Correct answer
- \(\sum_{n=1}^{10^7} M(n) = 39782849136421\).

## Correct approach
- Solve \(a^2 \equiv a \pmod n\) as idempotents: for each prime-power factor \(q_i=p_i^{e_i}\) of \(n\), residue must be \(0\) or \(1\) mod \(q_i\).
- By CRT, each binary choice vector gives one solution; number of solutions is \(2^{\omega(n)}\) where \(\omega(n)\) is the number of distinct prime factors.
- Let \(N_i=n/q_i\), and \(w_i \equiv N_i\cdot N_i^{-1}\pmod{q_i}\) lifted modulo \(n\), i.e.
  \(w_i = (N_i \cdot \mathrm{inv}(N_i \bmod q_i, q_i)) \bmod n\).
- Every idempotent is a subset sum of the \(w_i\) modulo \(n\):
  \(a_S = \left(\sum_{i\in S} w_i\right)\bmod n\).
- Therefore:
  - \(M(1)=0\).
  - If \(n\) is a prime power (\(\omega(n)=1\)), only \(0,1\) occur, so \(M(n)=1\).
  - Otherwise, \(M(n)=\max_{S\subseteq\{1,\dots,\omega(n)\}} a_S\), computed by subset enumeration.
- Efficient computation to \(10^7\):
  - Build smallest-prime-factor sieve.
  - Factor each \(n\) into distinct prime powers.
  - Build \(w_i\).
  - Enumerate subset sums with bitmask DP (\(2^{\omega(n)}\) states; for \(n\le 10^7\), \(\omega(n)\le 8\)).
  - Accumulate \(M(n)\).

## Wrong approaches and why they fail
- Collapsing constraints to only two components (\(2^a\) and odd part \(m\)) and treating only four CRT cases is wrong for odd \(n\) with multiple distinct odd prime factors.
- Assuming \(M(n)=\max_i w_i\) fails when combining multiple \(w_i\) gives a larger valid residue (e.g., \(n=30\)).
- Assuming \(M(n)=\max(\max_i w_i,\ n+1-\min_i w_i)\) is not general; for larger \(\omega(n)\), other subsets can dominate (e.g., \(n=210\), \(n=3990\)).
- Heuristic closed forms like \(n-\varphi(n)\), \(n-\)smallest-prime-factor, etc., fail on small counterexamples.
