# PE 830 Findings

## Correct answer
- Let `N = 10^18` and `M = 83^3 * 89^3 * 97^3`.
- `S(N) mod M = 254179446930484376`.
- Prime-cube residues used in CRT:
- `S(N) mod 83^3 = 435901`
- `S(N) mod 89^3 = 228533`
- `S(N) mod 97^3 = 545030`

## Correct approach
- Start from
  `S(N) = sum_{k=0}^N C(N,k) k^N = sum_{i=0}^N (N)_i * S2(N,i) * 2^{N-i}`,
  where `S2` is Stirling number of the second kind and `(N)_i` is falling factorial.
- Compute modulo each `p^3` for `p in {83,89,97}`, then combine with CRT.
- For each such prime `p`, `N` is not divisible by `p`, and `v_p((N)_i)` grows with `i`; specifically terms with `i >= 3p` vanish modulo `p^3`. So only `i = 0..3p-1` are needed.
- Evaluate `S2(N,i)` via inclusion-exclusion:
  `S2(N,i) = (1/i!) * sum_{a=0}^i (-1)^{i-a} C(i,a) a^N`.
- In modular computation, keep the division by `i!` mathematically exact (use exact integer `i!` in lifting logic), then reduce modulo `p^3`.
- Sum all surviving `i`-terms modulo `p^3` for each prime cube, and apply CRT to recover the unique residue modulo `M`.

## Wrong approaches and why they fail
- Truncating at `i <= 2p` (instead of `i <= 3p-1`) drops valid contributions with `2p < i <= 3p-1`, producing the wrong result `10816049555945939`.
- Replacing carry-digit binomial behavior with a local `p * count_carry` factor in digit DP is not exact modulo `p^3`; missing p-adic unit corrections causes wrong totals.
- Guessing `0` after unfinished modular derivation is unsupported; one trace ended at the wrong answer `0`.
- Implementation pitfall: reducing `i!` modulo `p^3` before the inclusion-exclusion division step breaks correctness. Exact `i!` handling is required.
