# pe-504 findings

- Correct answer for `m=100`: raw count `694687`, and `694687 mod 99991 = 94741`.
- Sanity check from prompt: for `m=4`, the correct method reproduces `42`.

## Correct approach

- Use Pick's theorem on lattice quadrilateral `A(a,0), B(0,b), C(-c,0), D(0,-d)`.
- Area:
  - `Area = ((a+c)(b+d))/2` (shoelace).
- Boundary lattice points:
  - `B = gcd(a,b) + gcd(b,c) + gcd(c,d) + gcd(d,a)`.
  - Reason: each edge has `gcd(|dx|,|dy|)+1` points, and summing all edges then subtracting 4 shared vertices leaves the sum of gcds.
- Interior lattice points:
  - `I = Area - B/2 + 1`
  - `I = ((a+c)(b+d) - (gcd(a,b)+gcd(b,c)+gcd(c,d)+gcd(d,a)))/2 + 1`.
- Count tuples `(a,b,c,d) in [1,m]^4` where `I` is a perfect square.
- Efficient counting trick (used in correct traces): for fixed `(a,c)` with `X=a+c`, rewrite
  - `T = (a+c)(b+d) - (gcd(a,b)+gcd(b,c)+gcd(c,d)+gcd(d,a))`
  - `T = T1(b) + T2(d)` where
  - `T1(b)=X*b-(gcd(a,b)+gcd(b,c))`, `T2(d)=X*d-(gcd(c,d)+gcd(d,a))`.
  - Then require `T1(b)+T2(d) in {2(k^2-1)}`.

## Wrong approaches and failure modes

- Wrong boundary formula: using `B = gcd(a,b)+gcd(b,c)+gcd(c,d)+gcd(d,a)+4` (forgetting vertex double-count correction).
  - This shifts interior counts and fails the prompt check: gives `72` for `m=4` (should be `42`).
- Missing `+1` in Pick's theorem inversion (`I = (P-G)/2` instead of `I = (P-G)/2 + 1`).
  - Fails prompt check: gives `36` for `m=4`.
- Misreading "strictly contain" as counting total lattice points (interior + boundary) instead of interior only.
  - Fails prompt check: gives `27` for `m=4`.
- Direct line-equation inequality counting is error-prone (sign/orientation mistakes on BC/CD/DA are common); Pick's theorem avoids this pitfall.
