# Problem pe-511 Findings

## Correct Answer
935247012

## Correct Approach
- Let \(D(n)\) be the positive divisors of \(n\). We need ordered length-\(n\) sequences \((a_1,\dots,a_n)\) with \(a_i\in D(n)\) and
  \[
  a_1+\cdots+a_n \equiv -n \pmod{k}.
  \]
- Define residue counts
  \[
  w_r = \#\{d\mid n : d\equiv r \pmod{k}\},\quad r=0,\dots,k-1.
  \]
  For this problem, \(n=1234567898765=5\cdot 41\cdot 25343\cdot 237631\), so \(\tau(n)=16\) divisors and \(k=4321\).
- Form
  \[
  W(x)=\sum_{r=0}^{k-1} w_r x^r
  \]
  in \((\mathbb Z/10^9\mathbb Z)[x]/(x^k-1)\). Then the desired count is the coefficient of
  \(x^{(-n)\bmod k}\) in \(W(x)^n\).
- Compute \(W(x)^n\) by binary exponentiation. Each polynomial multiplication is a cyclic convolution modulo \(x^k-1\).
- Because modulus \(10^9\) is composite, do each convolution with NTT under multiple prime moduli and reconstruct by CRT:
  - Use three NTT-friendly primes (e.g. 998244353, 1004535809, 104857601).
  - Reconstruct each linear-convolution coefficient as an integer, then reduce mod \(10^9\), then fold indices \(i\) and \(i+k\) for cyclic reduction.
- Why three primes are needed: with coefficients reduced mod \(M=10^9\), a linear-convolution coefficient can be as large as
  \[
  k(M-1)^2 \approx 4321\cdot 10^{18} \approx 4.3\times 10^{21},
  \]
  so CRT modulus must exceed this bound for exact reconstruction.
- This method matches the given check \(Seq(1111,24)\equiv 840643584\pmod{10^9}\) and yields final last nine digits 935247012.

## Wrong Approaches And Why They Fail
- Recovering mod \(10^9\) from residues modulo unrelated odd primes only (even if their product exceeds \(10^9\)).
  - Knowing \(X\bmod p_1, X\bmod p_2\) gives \(X\bmod (p_1p_2)\), but does not determine \(X\bmod 2^9\cdot 5^9\).
- Using only two NTT primes for CRT in composite-mod convolution.
  - Product \(p_1p_2\) is too small for exact integer coefficient reconstruction at this scale, causing aliasing and wrong downstream results.
- Incorrect NTT twiddle scheduling.
  - If root handling is inconsistent (e.g., mixing a length-\(N\) root with \((mod-1)/len\) stage exponents incorrectly), convolution outputs are wrong even on small sanity tests.
- Blind floating FFT for integer-exact convolution at this modulus/size.
  - Intermediate sums are too large for naive double-precision exactness unless careful split-and-recombine controls are used.
