## Problem: pe-913

### Correct Answer
81340

### Correct Approach
Let `N = nm`. The row-major to column-major permutation on indices is:
- `sigma(i) = (i * n) mod (N - 1)` for `0 <= i < N-1`
- `sigma(N-1) = N-1`

Minimum swaps equals `N - (# cycles)`. Counting cycles of multiplication-by-`n` on `Z/(N-1)` gives:

`C_total = 1 + sum_{d | (N-1)} phi(d) / ord_d(n)`

(the extra `1` is the fixed index `N-1`; the divisor sum includes the `d=1` cycle for 0).
So:

`S(n,m) = nm - 1 - sum_{d | (nm-1)} phi(d) / ord_d(n)`

For the target sum, use `a = n^4`, `b = m^4`:
- `ab = (nm)^4`
- `M = (nm)^4 - 1 = (nm-1)(nm+1)((nm)^2+1)`
- `S(n^4,m^4) = (nm)^4 - 1 - sum_{d|M} phi(d)/ord_d(n^4)`
- `ord_d(n^4) = ord_d(n) / gcd(ord_d(n), 4)`

Then sum over `2 <= n <= m <= 100` and reduce mod `99991`.

### Wrong Approaches And Why They Fail
- Guessing a simple cycle-count formula like `cycles = gcd(n-1,m-1)+1` is wrong. Example: for `(n,m)=(3,4)`, this predicts `S=10`, but the true value is `8`.
- Off-by-one fixed-point accounting is a common trap. If one uses `S = nm - 2 - sum_{d | (nm-1)} phi(d)/ord_d(n)` (sum over all divisors), it undercounts by 1; for `(3,4)` it gives `7` instead of `8`.
- Directly simulating swaps/cycles for `n^4 x m^4` is infeasible at scale (`(nm)^4` entries, up to `10^16`), so number-theoretic cycle counting is required.

### Validation Anchors
- The derived formula reproduces the provided baseline:
  `sum_{2 <= n <= m <= 100} S(n,m) = 12578833`.
- Using the powered formula gives final modulo result `81340`.
