# Problem: pe-773 (Project Euler 773)

## Problem Statement
Let S_k be the set containing 2 and 5 and the first k primes that end in 7. For example, S_3 = {2,5,7,17,37}.

Define a k-Ruff number to be one that is not divisible by any element in S_k.

If N_k is the product of the numbers in S_k then define F(k) to be the sum of all k-Ruff numbers less than N_k that have last digit 7. Given F(3) = 76101452.

Find F(97), give your answer modulo 1,000,000,007.

## Correct Answer
556206950

## Correct Approach
Write valid numbers as:
- `a = 10t + 7`, with `0 <= t < M`
- `M = ∏ p_i`, where `p_i` are the first `k` primes ending in 7
- `N_k = 10M`

For each `p_i`, divisibility condition is:
- `10t + 7 ≡ 0 (mod p_i)` iff `t ≡ r_i (mod p_i)`, where `r_i = -7 * 10^{-1} (mod p_i)`
- So valid `t` must avoid one residue class per prime.

Count of valid `t`:
- `C = ∏ (p_i - 1) = φ(M)`

Using inclusion-exclusion + subset-size periodicity, define:
- `k(0)=0`, and for `s>0`:
  - `k(s)=7` if `s ≡ 1 (mod 4)`
  - `k(s)=1` if `s ≡ 2 (mod 4)`
  - `k(s)=3` if `s ≡ 3 (mod 4)`
  - `k(s)=9` if `s ≡ 0 (mod 4)`
- `f(s)=floor(7*k(s)/10)`, so pattern is `0,4,0,2,6,...` by `s mod 4` (with `f(0)=0`)

Compute binomial sums:
- `K = Σ_{s=0..k} (-1)^s * C(k,s) * k(s)`
- `F_f = Σ_{s=0..k} (-1)^s * C(k,s) * f(s)`

Then:
- `P = ∏ p_i`
- `sum_t = P*(C/2) + P*(F_f - 1) - (7/10)*(C + P*(K-1))`
- `F(k) = 10*sum_t + 7*C`
- evaluate modulo `1,000,000,007` using modular inverses of `2` and `10`.

Sanity check:
- This reproduces the given `F(3)=76101452` before computing `F(97)`.

## Wrong Approaches And Why They Fail
- **Dropping CRT reduction when summing coefficients**:
  - Treating `t = Σ x_i e_i` as an unreduced integer linear sum ignores per-tuple modulo-`M` reduction.
  - This gives wrong totals even when counts are correct.
- **Mixing integer and modular inverse expressions**:
  - Replacing integer terms by modulo-`p_i` residues (or modulo-`MOD` lifts) without tracking the multiple-of-`M` correction changes the integer sum.
  - The “missing multiple of `M`” term is essential.
- **Assuming class-sum symmetry across mod-10 residue classes**:
  - Counts across classes are balanced, but sums are not generally equal.
  - Small counterexamples (e.g., `N=70`) invalidate this shortcut.
- **Unverified character/Gaussian-integer formulation**:
  - A character decomposition can be valid in principle, but incorrect normalization/scaling gives wrong sample output (`k=3` check fails), so it cannot be trusted for `k=97`.
