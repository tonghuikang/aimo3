## Problem: pe-624 (Two consecutive heads / modular rational value)

### Correct Answer
984524441

### Problem Summary
Let `M` be the first time two consecutive heads appear (`HH` on tosses `M-1,M`).
Define `P(n)=Pr[n | M]`.  
Given prime `p`, `Q(a/b,p)` is the least positive `q` with `a ≡ bq (mod p)`.
So `Q(P(n),p)` is `P(n)` interpreted in `F_p` (when denominator is invertible mod `p`).

### Correct Approach
1. Distribution of first `HH` time:
   - `Pr(M=k) = F_{k-1} / 2^k` for `k>=2` (Fibonacci `F_0=0,F_1=1`).
2. Therefore
   - `P(n) = sum_{j>=1} F_{jn-1} / 2^{jn}`.
3. Summing this subsequence via Binet/geometric-series algebra gives exact rational form:
   - `P(n) = (2^n F_{n-1} + (-1)^{n-1}) / (2^{2n} - L_n 2^n + (-1)^n)`,
     where `L_n` is Lucas (`L_n = F_{n-1}+F_{n+1}`).
4. For `n=10^18`, `p=1,000,000,009`:
   - compute `2^n mod p`,
   - compute `F_{n-1}, L_n mod p` (fast doubling),
   - set
     `a = 2^n F_{n-1} + (-1)^{n-1}`,
     `b = 2^{2n} - L_n 2^n + (-1)^n`,
     then `Q = a * b^{-1} mod p`.
5. Result: `984524441`.

### Wrong Approaches and Why They Fail
- **Using the wrong conjugate scaling in modular Binet evaluation**:
  replacing the second term with `b = ε/a` (`ε=(-1)^n`) misses a `4^{-n}` factor.
  This breaks known checks (e.g., for `n=2,p=109`, returns `80` or `49` instead of `66`).

- **Validating infinite-series identities with finite truncation equality**:
  comparing partial sums directly to exact closed forms creates false mismatches and can reject correct formulas.
  Truncations only approximate the infinite sum.

- **Confusing `P(n)=Pr(M=n)` with divisibility `P(n)=Pr(n|M)`**:
  this drops the required sum over all multiples `jn` and yields the wrong target quantity.
