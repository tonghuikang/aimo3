# Problem pe-561 Findings

## Correct Answer
- `Q(10^12) mod 99991 = 60418`

## Correct Approach
- For `n = \prod p_i^{e_i}`,
  - `S(n) = \sum_{d|n}(\tau(d)-1) = \prod_i ((e_i+1)(e_i+2)/2) - \prod_i (e_i+1)`.
- For `N = (p_m#)^s` (so all `e_i = s`),
  - `S(N) = ((s+1)(s+2)/2)^m - (s+1)^m`.
- Define `E(m,s) = v2(S((p_m#)^s))`. For odd `m` (here `m=904961`):
  - If `s` is odd: `E(m,s) = m * (v2(s+1) - 1)`.
  - If `s` is even: `E(m,s) = v2(s) - 1`.
- For even `N=2M`, reindex odds/evens (`s=2k-1`, `s=2k`) to get:
  - `Q(N) = \sum_{s=1}^N E(m,s) = (m+1) * \sum_{k=1}^{M} v2(k)` with `M=N/2`.
- Use `\sum_{k=1}^{M} v2(k) = M - popcount(M)`.
  - For `N=10^12`, `M=5*10^11`, `popcount(M)=13`, so `\sum v2 = 499,999,999,987`.
  - `Q(10^12) = 904,962 * 499,999,999,987`.
  - Modulo `99991`, this is `60418`.
- Sanity check: `Q(8) = (904961+1) * \sum_{k=1}^{4} v2(k) = 904,962 * 3 = 2,714,886` (matches given value).

## Wrong Approaches And Why They Fail
- Misapplied LTE in the odd-exponent branch:
  - Using `v2(u^m-1)=v2(u-1)+v2(u+1)+v2(m)-1` when `m` is odd is incorrect.
  - The `+v2(u+1)-1` augmentation is an even-exponent case; for odd exponent, the extra factor is odd and does not contribute.
- This LTE mistake propagates into an overcounted global sum:
  - Wrong aggregate form: `Q(N) = m*(S(N+1)-N/2) + 2*S(N/4) + N/4`.
  - Correct aggregate form: `Q(N) = m*(S(N+1)-N/2) + S(N/4) + N/4`, which is equivalent to `(m+1)*S(N/2)` for `N` divisible by 4.
  - The wrong form produces `62430 (mod 99991)` instead of the correct `60418`.
- Overcomplicated residue-class bookkeeping on `t^m-2^m` is error-prone; the direct odd/even reindexing of `E(m,s)` is the stable route.
